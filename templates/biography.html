{% extends "base.html" %}

{% block title %}Biographie - Star Wars{% endblock %}

{% block content %}
<div class="card">
    <h1>üìñ Biographie de Personnage Star Wars</h1>
    
    <div style="margin-bottom: 2rem; padding: 2rem; background: rgba(255, 232, 31, 0.1); border-radius: 8px; text-align: center;">
        <h2 style="margin-bottom: 1rem;">Personnage s√©lectionn√©</h2>
        <p style="font-size: 2rem; color: #FFE81F; font-weight: bold; margin-bottom: 1.5rem;">
            ‚≠ê {{ character }} ‚≠ê
        </p>
        
        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            <button onclick="generateBiography()" style="font-size: 1.1rem;">
                ‚ú® G√©n√©rer la biographie
            </button>
            <button onclick="location.reload()" style="background: #4a90e2; font-size: 1.1rem;">
                üîÄ Personnage al√©atoire
            </button>
        </div>
    </div>
    
    <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
        <p>G√©n√©ration en cours...</p>
        <p style="font-size: 0.9rem; color: #aaa; margin-top: 0.5rem;">
            La Force travaille pour vous...
        </p>
    </div>
    
    <div id="biography-content" style="line-height: 1.8; font-size: 1.1rem;"></div>
    
    <div style="margin-top: 2rem; text-align: center;">
        <a href="/" class="btn" style="background: #4a4a6a;">
            ‚Üê Retour √† l'accueil
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function generateBiography() {
    const character = "{{ character }}";
    const loading = document.getElementById('loading');
    const content = document.getElementById('biography-content');
    
    // Afficher le loading
    loading.style.display = 'block';
    content.innerHTML = '';
    
    // Appel API
    fetch('/api/generate_biography', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ character: character })
    })
    .then(response => response.json())
    .then(data => {
        loading.style.display = 'none';
        
        if (data.biography) {
            // Formater le texte avec des paragraphes
            const paragraphs = data.biography.split('\n').filter(p => p.trim() !== '');
            let htmlContent = '<div style="background: rgba(0, 0, 0, 0.5); padding: 2rem; border-radius: 8px; border: 1px solid #FFE81F;">';
            
            paragraphs.forEach(paragraph => {
                htmlContent += '<p style="margin-bottom: 1rem;">' + paragraph + '</p>';
            });
            
            htmlContent += '</div>';
            content.innerHTML = htmlContent;
            
            // Scroll vers le contenu
            content.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        } else if (data.error) {
            content.innerHTML = '<div style="background: rgba(255, 0, 0, 0.2); padding: 2rem; border-radius: 8px; border: 2px solid red; text-align: center;"><p style="color: #ffcccc; font-size: 1.1rem;">‚ö†Ô∏è <strong>Erreur :</strong> ' + data.error + '</p><p style="color: #aaa; margin-top: 1rem; font-size: 0.95rem;">V√©rifiez votre cl√© API Mistral dans app.py</p></div>';
        }
    })
    .catch(error => {
        loading.style.display = 'none';
        content.innerHTML = '<div style="background: rgba(255, 0, 0, 0.2); padding: 2rem; border-radius: 8px; border: 2px solid red; text-align: center;"><p style="color: #ffcccc; font-size: 1.1rem;">‚ö†Ô∏è <strong>Erreur de connexion</strong></p><p style="color: #aaa; margin-top: 1rem;">Impossible de contacter l\'API. V√©rifiez votre connexion.</p></div>';
        console.error('Erreur:', error);
    });
}
</script>
{% endblock %}